<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hello World</title>
	<script src="../caller.js"></script>
</head>
<body>
  <h1>Promise example</h1>
   <pre id="result"></pre>
  <script async>
    let Promise = {

      콜백헬() {
          //비동기함수
          function get (url) {
            //XMLHttpRequest 객체 생tjd
            const xhr = new XMLHttpRequest();

            //서버 응답 시 호출될 이벤트 핸들러
            xhr.onreadystatechange = function() {
              if(xhr.readyState === XMLHttpRequest.DONE) {
                if(xhr.status === 200) {
                  //정상응답

                  /*
                    비동기식 처리 모델은 처리 완료를 기다리지 않고 즉시 다음 태스크를 실행한다.
                    따라서 비동기 함수 내에서 처리 결과를 반환(또는 전역변수에의 할당) 하면
                    기대한 대로 동작하지 않는다.
                    비동기 함수의 결과에 대한 처리는 함수 내에서 처리해야 한다.
                    */

                    console.log(xhr.response);
                    return xhr.response;
                } else { //비정상 응답
                  console.log('Error' + xhr.status);
                }
              }
            };

            // 비동기 방식으로 Request 오픈
            xhr.open('GET', url);

            // Request 전송
            xhr.send();
          }

          const url = 'http://jsonplaceholder.typicode.com/posts/1';

          /*
          get 함수는 비동기 함수이므로 처리 완료를 기다리지 않고 즉시 다음 태스크를 수행한다.
          즉, 함수의 실행이 완료하여 함수의 반환값을 받기 이저에 다음 태스크로 진행한다.
          따라서 res는 undefined이다.
          */

          const res = get(url);
        },

        에러처리의한계() {
          try {
            // setTimeout(()=> {throw 'Error';}, 1000);
          } catch(e) {
            console.log('에러를 캐치하지 못한다..');
            console.log(e);
          }

          //catch 이벤트 잘 모르겠음 ㅠ
        },

        프로미스의생성() {
          //Promise 객체의 생성
          // const promise = new Promise((resolve, reject) => {
          //   //비동기 작업을 수행한다.
          //   if(/*비동기 작업 수행 성공*/1) {
          //     //비동기 작업을 수행한다.
          //     resolve('result');
          //   } else {
          //     /*비동기 작업 실패*/
          //     reject('failure reason');
          //   }
          // });

          //비동기 함수
          function get(url) {
            return new Promise((resolve, reject) => {
              const xhr = new XMLHttpRequest();

              //서버 응답 시 호출될 이벤트 핸들러
              xhr.onreadystatechange = function() {
                //서버 응답 완료
                if(xhr.readyState === XMLHttpRequest.DONE) {
                  if(xhr.status === 200) { // 정상 응답
                    // resolve 메소드에 처리 결과를 전달
                    resolve(xhr.response);
                  } else { // 비정상 응답
                    // reject 메소드에 에러 메세지를 전달
                    reject('Error' + xhr.status);
                  }
                }
              };

              // 비동기 방식으로 Reuest를 오픈한다.
              xhr.open('GET', url);
              //Request를 전송한다.
              xhr.send();
            });
          }
          const url = 'http://jsonplaceholder.typicode.com/posts/1';

            /*
            비동기 함수 get은 Promise 객체를 반환한다.
            Promise 객체의 후속 메소드를 사용하여 비동기 처리 결과에 대한 후속 처리를 수행한다.
            */

            get(url).then(
              //첫 번째 콜백함수는 성공 (fulfilled, resolve 함수가 호출된 상태) 시 호출된다.
              result => document.getElementById('result').innerHTML = result,
              //두 번째 함수는 실패(rejected, reject 함수가 호출된 상태) 시 호출된다.
              error => console.log(error)
              );
            },



          }

    Caller.execute(Promise); // 모든 메소드를 실행하는 모듈

  </script>
</body>
</html>