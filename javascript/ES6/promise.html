<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hello World</title>
	<script src="../caller.js"></script>
</head>
<body>
  <h1>Promise example</h1>
  <script async>
    let Promise = {

      콜백헬() {
          //비동기함수
          function get (url) {
            //XMLHttpRequest 객체 생tjd
            const xhr = new XMLHttpRequest();

            //서버 응답 시 호출될 이벤트 핸들러
            xhr.onreadystatechange = function() {
              if(xhr.readyState === XMLHttpRequest.Done) {
                if(xhr.status === 200) {
                  //정상응답

                  /*
                    비동기식 처리 모델은 처리 완료를 기다리지 않고 즉시 다음 태스크를 실행한다.
                    따라서 비동기 함수 내에서 처리 결과를 반환(또는 전역변수에의 할당) 하면
                    기대한 대로 동작하지 않는다.
                    비동기 함수의 결과에 대한 처리는 함수 내에서 처리해야 한다.
                  */

                  console.log(xhr.response);
                  return xhr.response;
                } else { //비정상 응답
                  console.log('Error' + xhr.status);
                }
              }
            };

            // 비동기 방식으로 Request 오픈
            xhr.open('GET', url);

            // Request 전송
            xhr.send();
          }

          const url = 'http://jsonplaceholder.typicode.com/posts/1';

          /*
          get 함수는 비동기 함수이므로 처리 완료를 기다리지 않고 즉시 다음 태스크를 수행한다.
          즉, 함수의 실행이 완료하여 함수의 반환값을 받기 이저에 다음 태스크로 진행한다.
          따라서 res는 undefined이다.
          */

          const res = get(url);
        },
        
      }

    Caller.execute(Promise); // 모든 메소드를 실행하는 모듈

  </script>
</body>
</html>